---
title: "Pipes [200]"
tags: [Timisoara CTF, Reversing]
excerpt: "Reversing"
layout: single
classes: wide
--- 

**Category:** Reversing 

> The program seems to smoke a lot.

## Write-up
As usual, first we decompile the binary using Ghidra for analysis. The code below are the important parts of the decompilation:

**rol** function:
```c
int rol(uchar *character,int max)

{
  int i;
  
  i = 0;
  while (i < max) {
    *character = *character * 2 | *character >> 7;
    i = i + 1;
  }
}
```
Part of the code in **main**:
```c
      character = character + 0x60;
      rol(&character,2);
      character = !(character ^ 0x7f);
      final = character * 0xed;
```

As the challenge name suggests, understanding of the C pipe() system call is required to solve this challenge. GeeksforGeeks explained and demonstrated the concept of pipes in C fairly well: https://www.geeksforgeeks.org/c-program-demonstrate-fork-and-pipe/  

The challenge is quite simple. For every character in the input, it performs mathematical functions such as XOR, OR, NOT and basic arithmetic. It then checks if the final value is equal to the value stored.  

To obtain the flag, we can replicate the operations performed on each character in the flag. By brute-forcing every possible character for each position in the flag, we can find out which character matches the value stored in the binary, thus giving us the entire flag. 

Here's final code to solve the challenge:
```python
a = [0xb2, 0x35, 0x00, 0x00, 0x9a, 0xb3, 0x00, 0x00, 0xa6, 0x74, 0x00, 0x00, 0x1f, 0xad, 0x00, 0x00, 0xb6, 0xbe, 0x00, 0x00, 0xb6, 0xbe, 0x00, 0x00, 0x17, 0x88, 0x00, 0x00, 0xa6, 0x74, 0x00, 0x00, 0x7f, 0x8f, 0x00, 0x00, 0xd3, 0xb0, 0x00, 0x00, 0xef, 0xbb, 0x00, 0x00, 0xa6, 0x74, 0x00, 0x00, 0x87, 0xb4, 0x00, 0x00, 0x9b, 0x9a, 0x00, 0x00, 0x1a, 0x3d, 0x00, 0x00, 0xcb, 0x8b, 0x00, 0x00, 0xa6, 0x74, 0x00, 0x00, 0x9b, 0x9a, 0x00, 0x00, 0x7f, 0x8f, 0x00, 0x00, 0xa6, 0x74, 0x00, 0x00, 0x57, 0xc3, 0x00, 0x00, 0xe7, 0x96, 0x00, 0x00, 0xcb, 0x8b, 0x00, 0x00, 0xef, 0xbb, 0x00, 0x00, 0xcb, 0x8b, 0x00, 0x00, 0xa6, 0x74, 0x00, 0x00, 0x9b, 0x9a, 0x00, 0x00, 0xa3, 0xbf, 0x00, 0x00, 0xa6, 0x74, 0x00, 0x00, 0xb2, 0x35, 0x00, 0x00, 0x9a, 0xb3, 0x00, 0x00, 0xa6, 0x74, 0x00, 0x00, 0x87, 0xb4, 0x00, 0x00, 0x2e, 0x23, 0x00, 0x00, 0x87, 0xb4, 0x00, 0x00, 0x5e, 0x14, 0x00, 0x00, 0x73, 0xce, 0x00, 0x00, 0x5e, 0x14, 0x00, 0x00, 0xcb, 0x8b, 0x00, 0x00, 0xaa, 0x10, 0x00, 0x00]
final = []
flag = 'TIMCTF{'

for j in range(7, 0x2f):
    q = (j-7)*4
    final.append(a[q])


for val in final:
    for c in range(32, 127):
        test = c + 0x60
        for i in range(2):
            test = (test * 2) | (test >> 7)

        test ^= 0x7f
        test ^= 255
        test *= 0xed

        test = test & 0xff
        if test  == val:
            flag += chr(c)

flag += "}"
print flag

```

**Flag:** TIMCTF{N0_n33d_for_piPe_if_there_is_N0_pIpEwEeD}